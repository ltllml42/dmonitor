/*
 * jQuery Raty - A Star Rating Plugin
 *
 * The MIT License
 *
 * @author  : Washington Botelho
 * @doc     : http://wbotelhos.com/raty
 * @version : 2.7.0
 *
 */
(function(B){var A={init:function(C){return this.each(function(){this.self=B(this);A.destroy.call(this.self);this.opt=B.extend(true,{},B.fn.raty.defaults,C);A._adjustCallback.call(this);A._adjustNumber.call(this);A._adjustHints.call(this);this.opt.score=A._adjustedScore.call(this,this.opt.score);if(this.opt.starType!=="img"){A._adjustStarType.call(this)}A._adjustPath.call(this);A._createStars.call(this);if(this.opt.cancel){A._createCancel.call(this)}if(this.opt.precision){A._adjustPrecision.call(this)}A._createScore.call(this);A._apply.call(this,this.opt.score);A._setTitle.call(this,this.opt.score);A._target.call(this,this.opt.score);if(this.opt.readOnly){A._lock.call(this)}else{this.style.cursor="pointer";A._binds.call(this)}})},_adjustCallback:function(){var D=["number","readOnly","score","scoreName","target"];for(var C=0;C<D.length;C++){if(typeof this.opt[D[C]]==="function"){this.opt[D[C]]=this.opt[D[C]].call(this)}}},_adjustedScore:function(C){if(!C){return C}return A._between(C,0,this.opt.number)},_adjustHints:function(){if(!this.opt.hints){this.opt.hints=[]}if(!this.opt.halfShow&&!this.opt.half){return}var D=this.opt.precision?10:2;for(var F=0;F<this.opt.number;F++){var C=this.opt.hints[F];if(Object.prototype.toString.call(C)!=="[object Array]"){C=[C]}this.opt.hints[F]=[];for(var G=0;G<D;G++){var E=C[G],H=C[C.length-1];if(H===undefined){H=null}this.opt.hints[F][G]=E===undefined?H:E}}},_adjustNumber:function(){this.opt.number=A._between(this.opt.number,1,this.opt.numberMax)},_adjustPath:function(){this.opt.path=this.opt.path||"";if(this.opt.path&&this.opt.path.charAt(this.opt.path.length-1)!=="/"){this.opt.path+="/"}},_adjustPrecision:function(){this.opt.half=true},_adjustStarType:function(){var D=["cancelOff","cancelOn","starHalf","starOff","starOn"];this.opt.path="";for(var C=0;C<D.length;C++){this.opt[D[C]]=this.opt[D[C]].replace(".","-")}},_apply:function(C){A._fill.call(this,C);if(C){if(C>0){this.score.val(C)}A._roundStars.call(this,C)}},_between:function(C,D,E){return Math.min(Math.max(parseFloat(C),D),E)},_binds:function(){if(this.cancel){A._bindOverCancel.call(this);A._bindClickCancel.call(this);A._bindOutCancel.call(this)}A._bindOver.call(this);A._bindClick.call(this);A._bindOut.call(this)},_bindClick:function(){var C=this;C.stars.on("click.raty",function(E){var F=true,D=(C.opt.half||C.opt.precision)?C.self.data("score"):(this.alt||B(this).data("alt"));if(C.opt.click){F=C.opt.click.call(C,+D,E)}if(F||F===undefined){if(C.opt.half&&!C.opt.precision){D=A._roundHalfScore.call(C,D)}A._apply.call(C,D)}})},_bindClickCancel:function(){var C=this;C.cancel.on("click.raty",function(D){C.score.removeAttr("value");if(C.opt.click){C.opt.click.call(C,null,D)}})},_bindOut:function(){var C=this;C.self.on("mouseleave.raty",function(E){var D=+C.score.val()||undefined;A._apply.call(C,D);A._target.call(C,D,E);A._resetTitle.call(C);if(C.opt.mouseout){C.opt.mouseout.call(C,D,E)}})},_bindOutCancel:function(){var C=this;C.cancel.on("mouseleave.raty",function(E){var F=C.opt.cancelOff;if(C.opt.starType!=="img"){F=C.opt.cancelClass+" "+F}A._setIcon.call(C,this,F);if(C.opt.mouseout){var D=+C.score.val()||undefined;C.opt.mouseout.call(C,D,E)}})},_bindOver:function(){var C=this,D=C.opt.half?"mousemove.raty":"mouseover.raty";C.stars.on(D,function(F){var E=A._getScoreByPosition.call(C,F,this);A._fill.call(C,E);if(C.opt.half){A._roundStars.call(C,E,F);A._setTitle.call(C,E,F);C.self.data("score",E)}A._target.call(C,E,F);if(C.opt.mouseover){C.opt.mouseover.call(C,E,F)}})},_bindOverCancel:function(){var C=this;C.cancel.on("mouseover.raty",function(E){var D=C.opt.path+C.opt.starOff,F=C.opt.cancelOn;if(C.opt.starType==="img"){C.stars.attr("src",D)}else{F=C.opt.cancelClass+" "+F;C.stars.attr("class",D)}A._setIcon.call(C,this,F);A._target.call(C,null,E);if(C.opt.mouseover){C.opt.mouseover.call(C,null)}})},_buildScoreField:function(){return B("<input />",{name:this.opt.scoreName,type:"hidden"}).appendTo(this)},_createCancel:function(){var C=this.opt.path+this.opt.cancelOff,D=B("<"+this.opt.starType+" />",{title:this.opt.cancelHint,"class":this.opt.cancelClass});if(this.opt.starType==="img"){D.attr({src:C,alt:"x"})}else{D.attr("data-alt","x").addClass(C)}if(this.opt.cancelPlace==="left"){this.self.prepend("&#160;").prepend(D)}else{this.self.append("&#160;").append(D)}this.cancel=D},_createScore:function(){var C=B(this.opt.targetScore);this.score=C.length?C:A._buildScoreField.call(this)},_createStars:function(){for(var D=1;D<=this.opt.number;D++){var C=A._nameForIndex.call(this,D),E={alt:D,src:this.opt.path+this.opt[C]};if(this.opt.starType!=="img"){E={"data-alt":D,"class":E.src}}E.title=A._getHint.call(this,D);B("<"+this.opt.starType+" />",E).appendTo(this);if(this.opt.space){this.self.append(D<this.opt.number?"&#160;":"")}}this.stars=this.self.children(this.opt.starType)},_error:function(C){B(this).text(C);B.error(C)},_fill:function(E){var D=0;for(var I=1;I<=this.stars.length;I++){var F,G=this.stars[I-1],H=A._turnOn.call(this,I,E);if(this.opt.iconRange&&this.opt.iconRange.length>D){var C=this.opt.iconRange[D];F=A._getRangeIcon.call(this,C,H);if(I<=C.range){A._setIcon.call(this,G,F)}if(I===C.range){D++}}else{F=this.opt[H?"starOn":"starOff"];A._setIcon.call(this,G,F)}}},_getFirstDecimal:function(D){var E=D.toString().split(".")[1],C=0;if(E){C=parseInt(E.charAt(0),10);if(E.slice(1,5)==="9999"){C++}}return C},_getRangeIcon:function(C,D){return D?C.on||this.opt.starOn:C.off||this.opt.starOff},_getScoreByPosition:function(E,F){var D=parseInt(F.alt||F.getAttribute("data-alt"),10);if(this.opt.half){var C=A._getWidth.call(this),G=parseFloat((E.pageX-B(F).offset().left)/C);D=D-1+G}return D},_getHint:function(E,F){if(E!==0&&!E){return this.opt.noRatedMsg}var I=A._getFirstDecimal.call(this,E),H=Math.ceil(E),G=this.opt.hints[(H||1)-1],D=G,C=!F||this.move;if(this.opt.precision){if(C){I=I===0?9:I-1}D=G[I]}else{if(this.opt.halfShow||this.opt.half){I=C&&I===0?1:I>5?1:0;D=G[I]}}return D===""?"":D||E},_getWidth:function(){var C=this.stars[0].width||parseFloat(this.stars.eq(0).css("font-size"));if(!C){A._error.call(this,"Could not get the icon width!")}return C},_lock:function(){var C=A._getHint.call(this,this.score.val());this.style.cursor="";this.title=C;this.score.prop("readonly",true);this.stars.prop("title",C);if(this.cancel){this.cancel.hide()}this.self.data("readonly",true)},_nameForIndex:function(C){return this.opt.score&&this.opt.score>=C?"starOn":"starOff"},_resetTitle:function(C){for(var D=0;D<this.opt.number;D++){this.stars[D].title=A._getHint.call(this,D+1)}},_roundHalfScore:function(C){var D=parseInt(C,10),E=A._getFirstDecimal.call(this,C);if(E!==0){E=E>5?1:0.5}return D+E},_roundStars:function(D,E){var H=(D%1).toFixed(2),C;if(E||this.move){C=H>0.5?"starOn":"starHalf"}else{if(H>this.opt.round.down){C="starOn";if(this.opt.halfShow&&H<this.opt.round.up){C="starHalf"}else{if(H<this.opt.round.full){C="starOff"}}}}if(C){var G=this.opt[C],F=this.stars[Math.ceil(D)-1];A._setIcon.call(this,F,G)}},_setIcon:function(D,C){try{D[this.opt.starType==="img"?"src":"className"]=this.opt.path+C}catch(E){}},_setTarget:function(D,C){if(C){C=this.opt.targetFormat.toString().replace("{score}",C)}if(D.is(":input")){D.val(C)}else{D.html(C)}},_setTitle:function(C,D){if(C){var F=parseInt(Math.ceil(C),10),E=this.stars[F-1];E.title=A._getHint.call(this,C,D)}},_target:function(C,D){if(this.opt.target){var E=B(this.opt.target);if(!E.length){A._error.call(this,"Target selector invalid or missing!")}var F=D&&D.type==="mouseover";if(C===undefined){C=this.opt.targetText}else{if(C===null){C=F?this.opt.cancelHint:this.opt.targetText}else{if(this.opt.targetType==="hint"){C=A._getHint.call(this,C,D)}else{if(this.opt.precision){C=parseFloat(C).toFixed(1)}}var G=D&&D.type==="mousemove";if(!F&&!G&&!this.opt.targetKeep){C=this.opt.targetText}}}A._setTarget.call(this,E,C)}},_turnOn:function(D,C){return this.opt.single?(D===C):(D<=C)},_unlock:function(){this.style.cursor="pointer";this.removeAttribute("title");this.score.removeAttr("readonly");this.self.data("readonly",false);for(var C=0;C<this.opt.number;C++){this.stars[C].title=A._getHint.call(this,C+1)}if(this.cancel){this.cancel.css("display","")}},cancel:function(C){return this.each(function(){var D=B(this);if(D.data("readonly")!==true){A[C?"click":"score"].call(D,null);this.score.removeAttr("value")}})},click:function(C){return this.each(function(){if(B(this).data("readonly")!==true){C=A._adjustedScore.call(this,C);A._apply.call(this,C);if(this.opt.click){this.opt.click.call(this,C,B.Event("click"))}A._target.call(this,C)}})},destroy:function(){return this.each(function(){var D=B(this),C=D.data("raw");if(C){D.off(".raty").empty().css({cursor:C.style.cursor}).removeData("readonly")}else{D.data("raw",D.clone()[0])}})},getScore:function(){var D=[],C;this.each(function(){C=this.score.val();D.push(C?+C:undefined)});return(D.length>1)?D:D[0]},move:function(C){return this.each(function(){var I=parseInt(C,10),J=A._getFirstDecimal.call(this,C);if(I>=this.opt.number){I=this.opt.number-1;J=10}var D=A._getWidth.call(this),F=D/10,H=B(this.stars[I]),G=H.offset().left+F*J,E=B.Event("mousemove",{pageX:G});this.move=true;H.trigger(E);this.move=false})},readOnly:function(C){return this.each(function(){var D=B(this);if(D.data("readonly")!==C){if(C){D.off(".raty").children("img").off(".raty");A._lock.call(this)}else{A._binds.call(this);A._unlock.call(this)}D.data("readonly",C)}})},reload:function(){return A.set.call(this,{})},score:function(){var C=B(this);return arguments.length?A.setScore.apply(C,arguments):A.getScore.call(C)},set:function(C){return this.each(function(){B(this).raty(B.extend({},this.opt,C))})},setScore:function(C){return this.each(function(){if(B(this).data("readonly")!==true){C=A._adjustedScore.call(this,C);A._apply.call(this,C);A._target.call(this,C)}})}};B.fn.raty=function(C){if(A[C]){return A[C].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof C==="object"||!C){return A.init.apply(this,arguments)}else{B.error("Method "+C+" does not exist!")}}};B.fn.raty.defaults={cancel:false,cancelClass:"raty-cancel",cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:false,halfShow:true,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseout:undefined,mouseover:undefined,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:undefined,precision:false,readOnly:false,round:{down:0.25,full:0.6,up:0.76},score:undefined,scoreName:"score",single:false,space:true,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",starType:"img",target:undefined,targetFormat:"{score}",targetKeep:false,targetScore:undefined,targetText:"",targetType:"hint"}})(jQuery);
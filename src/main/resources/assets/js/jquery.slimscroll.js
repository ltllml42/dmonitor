/* Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.3.3
 *
 */
(function(A){A.fn.extend({slimScroll:function(D){var B={width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:0.4,alwaysVisible:false,disableFadeOut:false,railVisible:false,railColor:"#333",railOpacity:0.2,railDraggable:true,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:false,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"};var C=A.extend(B,D);this.each(function(){var V,L,F,W,U,H,M,I,Q="<div></div>",Z=30,S=false;var G=A(this);if(G.parent().hasClass(C.wrapperClass)){var X=G.scrollTop();R=G.parent().find("."+C.barClass);N=G.parent().find("."+C.railClass);O();if(A.isPlainObject(D)){if("height" in D&&D.height=="auto"){G.parent().css("height","auto");G.css("height","auto");var J=G.parent().parent().height();G.parent().css("height",J);G.css("height",J)}if("scrollTo" in D){X=parseInt(C.scrollTo)}else{if("scrollBy" in D){X+=parseInt(C.scrollBy)}else{if("destroy" in D){R.remove();N.remove();G.unwrap();return}}}E(X,false,true)}return}else{if(A.isPlainObject(D)){if("destroy" in D){return}}}C.height=(C.height=="auto")?G.parent().height():C.height;var K=A(Q).addClass(C.wrapperClass).css({position:"relative",overflow:"hidden",width:C.width,height:C.height});G.css({overflow:"hidden",width:C.width,height:C.height});var N=A(Q).addClass(C.railClass).css({width:C.size,height:"100%",position:"absolute",top:0,display:(C.alwaysVisible&&C.railVisible)?"block":"none","border-radius":C.railBorderRadius,background:C.railColor,opacity:C.railOpacity,zIndex:90});var R=A(Q).addClass(C.barClass).css({background:C.color,width:C.size,position:"absolute",top:0,opacity:C.opacity,display:C.alwaysVisible?"block":"none","border-radius":C.borderRadius,BorderRadius:C.borderRadius,MozBorderRadius:C.borderRadius,WebkitBorderRadius:C.borderRadius,zIndex:99});var P=(C.position=="right")?{right:C.distance}:{left:C.distance};N.css(P);R.css(P);G.wrap(K);G.parent().append(R);G.parent().append(N);if(C.railDraggable){R.bind("mousedown",function(d){var c=A(document);F=true;t=parseFloat(R.css("top"));pageY=d.pageY;c.bind("mousemove.slimscroll",function(f){currTop=t+f.pageY-pageY;R.css("top",currTop);E(0,R.position().top,false)});c.bind("mouseup.slimscroll",function(f){F=false;T();c.unbind(".slimscroll")});return false}).bind("selectstart.slimscroll",function(c){c.stopPropagation();c.preventDefault();return false})}N.hover(function(){b()},function(){T()});R.hover(function(){L=true},function(){L=false});G.hover(function(){V=true;b();T()},function(){V=false;T()});G.bind("touchstart",function(d,c){if(d.originalEvent.touches.length){U=d.originalEvent.touches[0].pageY}});G.bind("touchmove",function(d){if(!S){d.originalEvent.preventDefault()}if(d.originalEvent.touches.length){var c=(U-d.originalEvent.touches[0].pageY)/C.touchScrollStep;E(c,true);U=d.originalEvent.touches[0].pageY}});O();if(C.start==="bottom"){R.css({top:G.outerHeight()-R.outerHeight()});E(0,true)}else{if(C.start!=="top"){E(A(C.start).position().top,null,true);if(!C.alwaysVisible){R.hide()}}}a();function Y(f){if(!V){return}var f=f||window.event;var d=0;if(f.wheelDelta){d=-f.wheelDelta/120}if(f.detail){d=f.detail/3}var c=f.target||f.srcTarget||f.srcElement;if(A(c).closest("."+C.wrapperClass).is(G.parent())){E(d,true)}if(f.preventDefault&&!S){f.preventDefault()}if(!S){f.returnValue=false}}function E(c,e,f){S=false;var g=c;var d=G.outerHeight()-R.outerHeight();if(e){g=parseInt(R.css("top"))+c*parseInt(C.wheelStep)/100*R.outerHeight();g=Math.min(Math.max(g,0),d);g=(c>0)?Math.ceil(g):Math.floor(g);R.css({top:g+"px"})}M=parseInt(R.css("top"))/(G.outerHeight()-R.outerHeight());g=M*(G[0].scrollHeight-G.outerHeight());if(f){g=c;var h=g/G[0].scrollHeight*G.outerHeight();h=Math.min(Math.max(h,0),d);R.css({top:h+"px"})}G.scrollTop(g);G.trigger("slimscrolling",~~g);b();T()}function a(){if(window.addEventListener){this.addEventListener("DOMMouseScroll",Y,false);this.addEventListener("mousewheel",Y,false)}else{document.attachEvent("onmousewheel",Y)}}function O(){H=Math.max((G.outerHeight()/G[0].scrollHeight)*G.outerHeight(),Z);R.css({height:H+"px"});var c=H==G.outerHeight()?"none":"block";R.css({display:c})}function b(){O();clearTimeout(W);if(M==~~M){S=C.allowPageScroll;if(I!=M){var c=(~~M==0)?"top":"bottom";G.trigger("slimscroll",c)}}else{S=false}I=M;if(H>=G.outerHeight()){S=true;return}R.stop(true,true).fadeIn("fast");if(C.railVisible){N.stop(true,true).fadeIn("fast")}}function T(){if(!C.alwaysVisible){W=setTimeout(function(){if(!(C.disableFadeOut&&V)&&!L&&!F){R.fadeOut("slow");N.fadeOut("slow")}},1000)}}});return this}});A.fn.extend({slimscroll:A.fn.slimScroll})})(jQuery);
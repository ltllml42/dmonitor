(function(A,C,B){(function(D){if(typeof define==="function"&&define.amd){define(["jquery"],D)}else{if(jQuery&&!jQuery.fn.sparkline){D(jQuery)}}}(function(J){var g={},K,L,Q,M,h,U,R,E,F,k,T,Y,D,O,W,j,f,b,e,d,N,X,l,Z,G,c,S,i,a,H,P,I,V=0;K=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:false,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:false,enableHighlight:true,highlightLighten:1.4,tooltipSkipNull:true,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:false,numberFormatter:false,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:false,disableInteraction:false},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:B,normalRangeMax:B,normalRangeColor:"#ccc",drawNormalOnTop:false,chartRangeMin:B,chartRangeMax:B,chartRangeMinX:B,chartRangeMaxX:B,tooltipFormat:new Q('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:B,nullColor:B,zeroAxis:true,barWidth:4,barSpacing:1,chartRangeMax:B,chartRangeMin:B,chartRangeClip:false,colorMap:B,tooltipFormat:new Q('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new Q('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss","0":"Draw","1":"Win"}}},discrete:{lineHeight:"auto",thresholdColor:B,thresholdValue:0,chartRangeMax:B,chartRangeMin:B,chartRangeClip:false,tooltipFormat:new Q("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:B,tooltipFormat:new Q("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new Q('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:false,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:true,outlierIQR:1.5,spotRadius:1.5,target:B,targetColor:"#4a2",chartRangeMax:B,chartRangeMin:B,tooltipFormat:new Q("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}};c='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}';L=function(){var n,m;n=function(){this.init.apply(this,arguments)};if(arguments.length>1){if(arguments[0]){n.prototype=J.extend(new arguments[0](),arguments[arguments.length-1]);n._super=arguments[0].prototype}else{n.prototype=arguments[arguments.length-1]}if(arguments.length>2){m=Array.prototype.slice.call(arguments,1,-1);m.unshift(n.prototype);J.extend.apply(J,m)}}else{n.prototype=arguments[0]}n.prototype.cls=n;return n};J.SPFormatClass=Q=L({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(m,n){this.format=m;this.fclass=n},render:function(p,n,m){var v=this,q=p,u,s,o,r,t;return this.format.replace(this.fre,function(){var w;s=arguments[1];o=arguments[3];u=v.precre.exec(s);if(u){t=u[2];s=u[1]}else{t=false}r=q[s];if(r===B){return""}if(o&&n&&n[o]){w=n[o];if(w.get){return n[o].get(r)||r}else{return n[o][r]||r}}if(F(r)){if(m.get("numberFormatter")){r=m.get("numberFormatter")(r)}else{r=O(r,t,m.get("numberDigitGroupCount"),m.get("numberDigitGroupSep"),m.get("numberDecimalMark"))}}return r})}});J.spformat=function(m,n){return new Q(m,n)};M=function(o,m,n){if(o<m){return m}if(o>n){return n}return o};h=function(n,o){var m;if(o===2){m=C.floor(n.length/2);return n.length%2?n[m]:(n[m-1]+n[m])/2}else{if(n.length%2){m=(n.length*o+o)/4;return m%1?(n[C.floor(m)]+n[C.floor(m)-1])/2:n[m-1]}else{m=(n.length*o+2)/4;return m%1?(n[C.floor(m)]+n[C.floor(m)-1])/2:n[m-1]}}};U=function(n){var m;switch(n){case"undefined":n=B;break;case"null":n=null;break;case"true":n=true;break;case"false":n=false;break;default:m=parseFloat(n);if(n==m){n=m}}return n};R=function(o){var n,m=[];for(n=o.length;n--;){m[n]=U(o[n])}return m};E=function(q,p){var o,n,m=[];for(o=0,n=q.length;o<n;o++){if(q[o]!==p){m.push(q[o])}}return m};F=function(m){return !isNaN(parseFloat(m))&&isFinite(m)};O=function(t,m,n,o,s){var r,q;t=(m===false?parseFloat(t).toString():t.toFixed(m)).split("");r=(r=J.inArray(".",t))<0?t.length:r;if(r<t.length){t[r]=s}for(q=r-n;q>0;q-=n){t.splice(q,0,o)}return t.join("")};k=function(p,n,m){var o;for(o=n.length;o--;){if(m&&n[o]===null){continue}if(n[o]!==p){return false}}return true};T=function(o){var m=0,n;for(n=o.length;n--;){m+=typeof o[n]==="number"?o[n]:0}return m};D=function(m){return J.isArray(m)?m:[m]};Y=function(n){var m;if(A.createStyleSheet){A.createStyleSheet().cssText=n}else{m=A.createElement("style");m.type="text/css";A.getElementsByTagName("head")[0].appendChild(m);m[(typeof A.body.style.WebkitAppearance=="string")?"innerText":"innerHTML"]=n}};J.fn.simpledraw=function(o,m,q,r){var s,p;if(q&&(s=this.data("_jqs_vcanvas"))){return s}if(J.fn.sparkline.canvas===false){return false}else{if(J.fn.sparkline.canvas===B){var n=A.createElement("canvas");if(!!(n.getContext&&n.getContext("2d"))){J.fn.sparkline.canvas=function(u,t,v,w){return new H(u,t,v,w)}}else{if(A.namespaces&&!A.namespaces.v){A.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML");J.fn.sparkline.canvas=function(u,t,v,w){return new P(u,t,v)}}else{J.fn.sparkline.canvas=false;return false}}}}if(o===B){o=J(this).innerWidth()}if(m===B){m=J(this).innerHeight()}s=J.fn.sparkline.canvas(o,m,this,r);p=J(this).data("_jqs_mhandler");if(p){p.registerCanvas(s)}return s};J.fn.cleardraw=function(){var m=this.data("_jqs_vcanvas");if(m){m.reset()}};J.RangeMapClass=W=L({init:function(p){var n,m,o=[];for(n in p){if(p.hasOwnProperty(n)&&typeof n==="string"&&n.indexOf(":")>-1){m=n.split(":");m[0]=m[0].length===0?-Infinity:parseFloat(m[0]);m[1]=m[1].length===0?Infinity:parseFloat(m[1]);m[2]=p[n];o.push(m)}}this.map=p;this.rangelist=o||false},get:function(n){var p=this.rangelist,q,m,o;if((o=this.map[n])!==B){return o}if(p){for(q=p.length;q--;){m=p[q];if(m[0]<=n&&m[1]>=n){return m[2]}}}return B}});J.range_map=function(m){return new W(m)};j=L({init:function(n,o){var m=J(n);this.$el=m;this.options=o;this.currentPageX=0;this.currentPageY=0;this.el=n;this.splist=[];this.tooltip=null;this.over=false;this.displayTooltips=!o.get("disableTooltips");this.highlightEnabled=!o.get("disableHighlight")},registerSparkline:function(m){this.splist.push(m);if(this.over){this.updateDisplay()}},registerCanvas:function(n){var m=J(n.canvas);this.canvas=n;this.$canvas=m;m.mouseenter(J.proxy(this.mouseenter,this));m.mouseleave(J.proxy(this.mouseleave,this));m.click(J.proxy(this.mouseclick,this))},reset:function(m){this.splist=[];if(this.tooltip&&m){this.tooltip.remove();this.tooltip=B}},mouseclick:function(m){var n=J.Event("sparklineClick");n.originalEvent=m;n.sparklines=this.splist;this.$el.trigger(n)},mouseenter:function(m){J(A.body).unbind("mousemove.jqs");J(A.body).bind("mousemove.jqs",J.proxy(this.mousemove,this));this.over=true;this.currentPageX=m.pageX;this.currentPageY=m.pageY;this.currentEl=m.target;if(!this.tooltip&&this.displayTooltips){this.tooltip=new f(this.options);this.tooltip.updatePosition(m.pageX,m.pageY)}this.updateDisplay()},mouseleave:function(){J(A.body).unbind("mousemove.jqs");var o=this.splist,m=o.length,n=false,q,p;this.over=false;this.currentEl=null;if(this.tooltip){this.tooltip.remove();this.tooltip=null}for(p=0;p<m;p++){q=o[p];if(q.clearRegionHighlight()){n=true}}if(n){this.canvas.render()}},mousemove:function(m){this.currentPageX=m.pageX;this.currentPageY=m.pageY;this.currentEl=m.target;if(this.tooltip){this.tooltip.updatePosition(m.pageX,m.pageY)}this.updateDisplay()},updateDisplay:function(){var r=this.splist,p=r.length,u=false,w=this.$canvas.offset(),n=this.currentPageX-w.left,o=this.currentPageY-w.top,t,s,m,v,q;if(!this.over){return}for(m=0;m<p;m++){s=r[m];v=s.setRegionHighlight(this.currentEl,n,o);if(v){u=true}}if(u){q=J.Event("sparklineRegionChange");q.sparklines=this.splist;this.$el.trigger(q);if(this.tooltip){t="";for(m=0;m<p;m++){s=r[m];t+=s.getCurrentRegionTooltip()}this.tooltip.setContent(t)}if(!this.disableHighlight){this.canvas.render()}}if(v===null){this.mouseleave()}}});f=L({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(o){var m=o.get("tooltipClassname","jqstooltip"),n=this.sizeStyle,p;this.container=o.get("tooltipContainer")||A.body;this.tooltipOffsetX=o.get("tooltipOffsetX",10);this.tooltipOffsetY=o.get("tooltipOffsetY",12);J("#jqssizetip").remove();J("#jqstooltip").remove();this.sizetip=J("<div/>",{id:"jqssizetip",style:n,"class":m});this.tooltip=J("<div/>",{id:"jqstooltip","class":m}).appendTo(this.container);p=this.tooltip.offset();this.offsetLeft=p.left;this.offsetTop=p.top;this.hidden=true;J(window).unbind("resize.jqs scroll.jqs");J(window).bind("resize.jqs scroll.jqs",J.proxy(this.updateWindowDims,this));this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=J(window).scrollTop();this.scrollLeft=J(window).scrollLeft();this.scrollRight=this.scrollLeft+J(window).width();this.updatePosition()},getSize:function(m){this.sizetip.html(m).appendTo(this.container);this.width=this.sizetip.width()+1;this.height=this.sizetip.height();this.sizetip.remove()},setContent:function(m){if(!m){this.tooltip.css("visibility","hidden");this.hidden=true;return}this.getSize(m);this.tooltip.html(m).css({"width":this.width,"height":this.height,"visibility":"visible"});if(this.hidden){this.hidden=false;this.updatePosition()}},updatePosition:function(m,n){if(m===B){if(this.mousex===B){return}m=this.mousex-this.offsetLeft;n=this.mousey-this.offsetTop}else{this.mousex=m=m-this.offsetLeft;this.mousey=n=n-this.offsetTop}if(!this.height||!this.width||this.hidden){return}n-=this.height+this.tooltipOffsetY;m+=this.tooltipOffsetX;if(n<this.scrollTop){n=this.scrollTop}if(m<this.scrollLeft){m=this.scrollLeft}else{if(m+this.width>this.scrollRight){m=this.scrollRight-this.width}}this.tooltip.css({"left":m,"top":n})},remove:function(){this.tooltip.remove();this.sizetip.remove();this.sizetip=this.tooltip=B;J(window).unbind("resize.jqs scroll.jqs")}});S=function(){Y(c)};J(S);I=[];J.fn.sparkline=function(m,n){return this.each(function(){var q=new J.fn.sparkline.options(this,n),r=J(this),o,p;o=function(){var x,t,s,w,u,y,v;if(m==="html"||m===B){v=this.getAttribute(q.get("tagValuesAttribute"));if(v===B||v===null){v=r.html()}x=v.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")}else{x=m}t=q.get("width")==="auto"?x.length*q.get("defaultPixelsPerValue"):q.get("width");if(q.get("height")==="auto"){if(!q.get("composite")||!J.data(this,"_jqs_vcanvas")){w=A.createElement("span");w.innerHTML="a";r.html(w);s=J(w).innerHeight()||J(w).height();J(w).remove();w=null}}else{s=q.get("height")}if(!q.get("disableInteraction")){u=J.data(this,"_jqs_mhandler");if(!u){u=new j(this,q);J.data(this,"_jqs_mhandler",u)}else{if(!q.get("composite")){u.reset()}}}else{u=false}if(q.get("composite")&&!J.data(this,"_jqs_vcanvas")){if(!J.data(this,"_jqs_errnotify")){alert("Attempted to attach a composite sparkline to an element with no existing sparkline");J.data(this,"_jqs_errnotify",true)}return}y=new J.fn.sparkline[q.get("type")](this,x,q,t,s);y.render();if(u){u.registerSparkline(y)}};if((J(this).html()&&!q.get("disableHiddenCheck")&&J(this).is(":hidden"))||!J(this).parents("body").length){if(!q.get("composite")&&J.data(this,"_jqs_pending")){for(p=I.length;p;p--){if(I[p-1][0]==this){I.splice(p-1,1)}}}I.push([this,o]);J.data(this,"_jqs_pending",true)}else{o.call(this)}})};J.fn.sparkline.defaults=K();J.sparkline_display_visible=function(){var n,p,o;var m=[];for(p=0,o=I.length;p<o;p++){n=I[p][0];if(J(n).is(":visible")&&!J(n).parents().is(":hidden")){I[p][1].call(n);J.data(I[p][0],"_jqs_pending",false);m.push(p)}else{if(!J(n).closest("html").length&&!J.data(n,"_jqs_pending")){J.data(I[p][0],"_jqs_pending",false);m.push(p)}}}for(p=m.length;p;p--){I.splice(m[p-1],1)}};J.fn.sparkline.options=L({init:function(o,q){var m,p,n,r;this.userOptions=q=q||{};this.tag=o;this.tagValCache={};p=J.fn.sparkline.defaults;n=p.common;this.tagOptionsPrefix=q.enableTagOptions&&(q.tagOptionsPrefix||n.tagOptionsPrefix);r=this.getTagSetting("type");if(r===g){m=p[q.type||n.type]}else{m=p[r]}this.mergedOptions=J.extend({},n,m,q)},getTagSetting:function(n){var o=this.tagOptionsPrefix,r,p,m,q;if(o===false||o===B){return g}if(this.tagValCache.hasOwnProperty(n)){r=this.tagValCache.key}else{r=this.tag.getAttribute(o+n);if(r===B||r===null){r=g}else{if(r.substr(0,1)==="["){r=r.substr(1,r.length-2).split(",");for(p=r.length;p--;){r[p]=U(r[p].replace(/(^\s*)|(\s*$)/g,""))}}else{if(r.substr(0,1)==="{"){m=r.substr(1,r.length-2).split(",");r={};for(p=m.length;p--;){q=m[p].split(":",2);r[q[0].replace(/(^\s*)|(\s*$)/g,"")]=U(q[1].replace(/(^\s*)|(\s*$)/g,""))}}else{r=U(r)}}}this.tagValCache.key=r}return r},get:function(n,m){var p=this.getTagSetting(n),o;if(p!==g){return p}return(o=this.mergedOptions[n])===B?m:o}});J.fn.sparkline._base=L({disabled:false,init:function(n,q,p,o,m){this.el=n;this.$el=J(n);this.values=q;this.options=p;this.width=o;this.height=m;this.currentRegion=B},initTarget:function(){var m=!this.options.get("disableInteraction");if(!(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),m))){this.disabled=true}else{this.canvasWidth=this.target.pixelWidth;this.canvasHeight=this.target.pixelHeight}},render:function(){if(this.disabled){this.el.innerHTML="";return false}return true},getRegion:function(m,n){},setRegionHighlight:function(o,m,n){var r=this.currentRegion,q=!this.options.get("disableHighlight"),p;if(m>this.canvasWidth||n>this.canvasHeight||m<0||n<0){return null}p=this.getRegion(o,m,n);if(r!==p){if(r!==B&&q){this.removeHighlight()}this.currentRegion=p;if(p!==B&&q){this.renderHighlight()}return true}return false},clearRegionHighlight:function(){if(this.currentRegion!==B){this.removeHighlight();this.currentRegion=B;return true}return false},renderHighlight:function(){this.changeHighlight(true)},removeHighlight:function(){this.changeHighlight(false)},changeHighlight:function(m){},getCurrentRegionTooltip:function(){var q=this.options,s="",p=[],n,w,x,o,m,u,Ac,t,Aa,y,r,z,Ab,v;if(this.currentRegion===B){return""}n=this.getCurrentRegionFields();r=q.get("tooltipFormatter");if(r){return r(this,q,n)}if(q.get("tooltipChartTitle")){s+='<div class="jqs jqstitle">'+q.get("tooltipChartTitle")+"</div>\n"}w=this.options.get("tooltipFormat");if(!w){return""}if(!J.isArray(w)){w=[w]}if(!J.isArray(n)){n=[n]}Ac=this.options.get("tooltipFormatFieldlist");t=this.options.get("tooltipFormatFieldlistKey");if(Ac&&t){Aa=[];for(u=n.length;u--;){y=n[u][t];if((v=J.inArray(y,Ac))!=-1){Aa[v]=n[u]}}n=Aa}x=w.length;Ab=n.length;for(u=0;u<x;u++){z=w[u];if(typeof z==="string"){z=new Q(z)}o=z.fclass||"jqsfield";for(v=0;v<Ab;v++){if(!n[v].isNull||!q.get("tooltipSkipNull")){J.extend(n[v],{prefix:q.get("tooltipPrefix"),suffix:q.get("tooltipSuffix")});m=z.render(n[v],q.get("tooltipValueLookups"),q);p.push('<div class="'+o+'">'+m+"</div>")}}}if(p.length){return s+p.join("\n")}return""},getCurrentRegionFields:function(){},calcHighlightColor:function(o,m){var s=m.get("highlightColor"),p=m.get("highlightLighten"),n,t,r,q;if(s){return s}if(p){n=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(o)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(o);if(n){r=[];t=o.length===4?16:1;for(q=0;q<3;q++){r[q]=M(C.round(parseInt(n[q+1],16)*t*p),0,255)}return"rgb("+r.join(",")+")"}}return o}});b={changeHighlight:function(m){var q=this.currentRegion,o=this.target,p=this.regionShapes[q],n;if(p){n=this.renderRegion(q,m);if(J.isArray(n)||J.isArray(p)){o.replaceWithShapes(p,n);this.regionShapes[q]=J.map(n,function(r){return r.id})}else{o.replaceWithShape(p,n);this.regionShapes[q]=n.id}}},render:function(){var r=this.values,o=this.target,m=this.regionShapes,n,s,p,q;if(!this.cls._super.render.call(this)){return}for(p=r.length;p--;){n=this.renderRegion(p);if(n){if(J.isArray(n)){s=[];for(q=n.length;q--;){n[q].append();s.push(n[q].id)}m[p]=s}else{n.append();m[p]=n.id}}else{m[p]=null}}o.render()}};J.fn.sparkline.line=e=L(J.fn.sparkline._base,{type:"line",init:function(n,q,p,o,m){e._super.init.call(this,n,q,p,o,m);this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];this.hightlightSpotId=null;this.lastShapeId=null;this.initTarget()},getRegion:function(o,m,n){var p,q=this.regionMap;for(p=q.length;p--;){if(q[p]!==null&&m>=q[p][0]&&m<=q[p][1]){return q[p][2]}}return B},getCurrentRegionFields:function(){var m=this.currentRegion;return{isNull:this.yvalues[m]===null,x:this.xvalues[m],y:this.yvalues[m],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:m}},renderHighlight:function(){var n=this.currentRegion,t=this.target,o=this.vertices[n],m=this.options,q=m.get("spotRadius"),u=m.get("highlightSpotColor"),r=m.get("highlightLineColor"),s,p;if(!o){return}if(q&&u){s=t.drawCircle(o[0],o[1],q,B,u);this.highlightSpotId=s.id;t.insertAfterShape(this.lastShapeId,s)}if(r){p=t.drawLine(o[0],this.canvasTop,o[0],this.canvasTop+this.canvasHeight,r);this.highlightLineId=p.id;t.insertAfterShape(this.lastShapeId,p)}},removeHighlight:function(){var m=this.target;if(this.highlightSpotId){m.removeShapeId(this.highlightSpotId);this.highlightSpotId=null}if(this.highlightLineId){m.removeShapeId(this.highlightLineId);this.highlightLineId=null}},scanValues:function(){var s=this.values,n=s.length,u=this.xvalues,r=this.yvalues,v=this.yminmax,m,o,q,t,p;for(m=0;m<n;m++){o=s[m];q=typeof(s[m])==="string";t=typeof(s[m])==="object"&&s[m] instanceof Array;p=q&&s[m].split(":");if(q&&p.length===2){u.push(Number(p[0]));r.push(Number(p[1]));v.push(Number(p[1]))}else{if(t){u.push(o[0]);r.push(o[1]);v.push(o[1])}else{u.push(m);if(s[m]===null||s[m]==="null"){r.push(null)}else{r.push(Number(o));v.push(Number(o))}}}}if(this.options.get("xvalues")){u=this.options.get("xvalues")}this.maxy=this.maxyorg=C.max.apply(C,v);this.miny=this.minyorg=C.min.apply(C,v);this.maxx=C.max.apply(C,u);this.minx=C.min.apply(C,u);this.xvalues=u;this.yvalues=r;this.yminmax=v},processRangeOptions:function(){var n=this.options,o=n.get("normalRangeMin"),m=n.get("normalRangeMax");if(o!==B){if(o<this.miny){this.miny=o}if(m>this.maxy){this.maxy=m}}if(n.get("chartRangeMin")!==B&&(n.get("chartRangeClip")||n.get("chartRangeMin")<this.miny)){this.miny=n.get("chartRangeMin")}if(n.get("chartRangeMax")!==B&&(n.get("chartRangeClip")||n.get("chartRangeMax")>this.maxy)){this.maxy=n.get("chartRangeMax")}if(n.get("chartRangeMinX")!==B&&(n.get("chartRangeClipX")||n.get("chartRangeMinX")<this.minx)){this.minx=n.get("chartRangeMinX")}if(n.get("chartRangeMaxX")!==B&&(n.get("chartRangeClipX")||n.get("chartRangeMaxX")>this.maxx)){this.maxx=n.get("chartRangeMaxX")}},drawNormalRange:function(o,r,m,t,s){var n=this.options.get("normalRangeMin"),u=this.options.get("normalRangeMax"),q=r+C.round(m-(m*((u-this.miny)/s))),p=C.round((m*(u-n))/s);this.target.drawRect(o,q,t,p,B,this.options.get("normalRangeColor")).append()},render:function(){var r=this.options,Aq=this.target,s=this.canvasWidth,z=this.canvasHeight,w=this.vertices,Ab=r.get("spotRadius"),Ah=this.regionMap,Ai,m,q,Aj,An,Al,Ap,Ac,At,p,As,Af,Ae,t,Ak,n,Aa,u,Am,v,o,Ad,Ar,Ag,Ao;if(!e._super.render.call(this)){return}this.scanValues();this.processRangeOptions();Ar=this.xvalues;Ag=this.yvalues;if(!this.yminmax.length||this.yvalues.length<2){return}Aj=An=0;Ai=this.maxx-this.minx===0?1:this.maxx-this.minx;m=this.maxy-this.miny===0?1:this.maxy-this.miny;q=this.yvalues.length-1;if(Ab&&(s<(Ab*4)||z<(Ab*4))){Ab=0}if(Ab){o=r.get("highlightSpotColor")&&!r.get("disableInteraction");if(o||r.get("minSpotColor")||(r.get("spotColor")&&Ag[q]===this.miny)){z-=C.ceil(Ab)}if(o||r.get("maxSpotColor")||(r.get("spotColor")&&Ag[q]===this.maxy)){z-=C.ceil(Ab);Aj+=C.ceil(Ab)}if(o||((r.get("minSpotColor")||r.get("maxSpotColor"))&&(Ag[0]===this.miny||Ag[0]===this.maxy))){An+=C.ceil(Ab);s-=C.ceil(Ab)}if(o||r.get("spotColor")||(r.get("minSpotColor")||r.get("maxSpotColor")&&(Ag[q]===this.miny||Ag[q]===this.maxy))){s-=C.ceil(Ab)}}z--;if(r.get("normalRangeMin")!==B&&!r.get("drawNormalOnTop")){this.drawNormalRange(An,Aj,z,s,m)}Ap=[];Ac=[Ap];t=Ak=null;n=Ag.length;for(Ao=0;Ao<n;Ao++){At=Ar[Ao];As=Ar[Ao+1];p=Ag[Ao];Af=An+C.round((At-this.minx)*(s/Ai));Ae=Ao<n-1?An+C.round((As-this.minx)*(s/Ai)):s;Ak=Af+((Ae-Af)/2);Ah[Ao]=[t||0,Ak,Ao];t=Ak;if(p===null){if(Ao){if(Ag[Ao-1]!==null){Ap=[];Ac.push(Ap)}w.push(null)}}else{if(p<this.miny){p=this.miny}if(p>this.maxy){p=this.maxy}if(!Ap.length){Ap.push([Af,Aj+z])}Al=[Af,Aj+C.round(z-(z*((p-this.miny)/m)))];Ap.push(Al);w.push(Al)}}Aa=[];u=[];Am=Ac.length;for(Ao=0;Ao<Am;Ao++){Ap=Ac[Ao];if(Ap.length){if(r.get("fillColor")){Ap.push([Ap[Ap.length-1][0],(Aj+z)]);u.push(Ap.slice(0));Ap.pop()}if(Ap.length>2){Ap[0]=[Ap[0][0],Ap[1][1]]}Aa.push(Ap)}}Am=u.length;for(Ao=0;Ao<Am;Ao++){Aq.drawShape(u[Ao],r.get("fillColor"),r.get("fillColor")).append()}if(r.get("normalRangeMin")!==B&&r.get("drawNormalOnTop")){this.drawNormalRange(An,Aj,z,s,m)}Am=Aa.length;for(Ao=0;Ao<Am;Ao++){Aq.drawShape(Aa[Ao],r.get("lineColor"),B,r.get("lineWidth")).append()}if(Ab&&r.get("valueSpots")){v=r.get("valueSpots");if(v.get===B){v=new W(v)}for(Ao=0;Ao<n;Ao++){Ad=v.get(Ag[Ao]);if(Ad){Aq.drawCircle(An+C.round((Ar[Ao]-this.minx)*(s/Ai)),Aj+C.round(z-(z*((Ag[Ao]-this.miny)/m))),Ab,B,Ad).append()}}}if(Ab&&r.get("spotColor")&&Ag[q]!==null){Aq.drawCircle(An+C.round((Ar[Ar.length-1]-this.minx)*(s/Ai)),Aj+C.round(z-(z*((Ag[q]-this.miny)/m))),Ab,B,r.get("spotColor")).append()}if(this.maxy!==this.minyorg){if(Ab&&r.get("minSpotColor")){At=Ar[J.inArray(this.minyorg,Ag)];Aq.drawCircle(An+C.round((At-this.minx)*(s/Ai)),Aj+C.round(z-(z*((this.minyorg-this.miny)/m))),Ab,B,r.get("minSpotColor")).append()}if(Ab&&r.get("maxSpotColor")){At=Ar[J.inArray(this.maxyorg,Ag)];Aq.drawCircle(An+C.round((At-this.minx)*(s/Ai)),Aj+C.round(z-(z*((this.maxyorg-this.miny)/m))),Ab,B,r.get("maxSpotColor")).append()}}this.lastShapeId=Aq.getLastShapeId();this.canvasTop=Aj;Aq.render()}});J.fn.sparkline.bar=d=L(J.fn.sparkline._base,b,{type:"bar",init:function(o,n,Aq,Ac,As){var Ab=parseInt(Aq.get("barWidth"),10),t=parseInt(Aq.get("barSpacing"),10),Ad=Aq.get("chartRangeMin"),Ai=Aq.get("chartRangeMax"),Au=Aq.get("chartRangeClip"),Ap=Infinity,Ao=-Infinity,r,Ag,Am,Av,x,Ae,z,s,An,Ar,u,Aw,q,m,Aj,Al,Af,v,Ak,w,p,At,Ah;d._super.init.call(this,o,n,Aq,Ac,As);for(Ae=0,z=n.length;Ae<z;Ae++){w=n[Ae];r=typeof(w)==="string"&&w.indexOf(":")>-1;if(r||J.isArray(w)){Aj=true;if(r){w=n[Ae]=R(w.split(":"))}w=E(w,null);Ag=C.min.apply(C,w);Am=C.max.apply(C,w);if(Ag<Ap){Ap=Ag}if(Am>Ao){Ao=Am}}}this.stacked=Aj;this.regionShapes={};this.barWidth=Ab;this.barSpacing=t;this.totalBarWidth=Ab+t;this.width=Ac=(n.length*Ab)+((n.length-1)*t);this.initTarget();if(Au){q=Ad===B?-Infinity:Ad;m=Ai===B?Infinity:Ai}x=[];Av=Aj?[]:x;var y=[];var Aa=[];for(Ae=0,z=n.length;Ae<z;Ae++){if(Aj){Al=n[Ae];n[Ae]=Ak=[];y[Ae]=0;Av[Ae]=Aa[Ae]=0;for(Af=0,v=Al.length;Af<v;Af++){w=Ak[Af]=Au?M(Al[Af],q,m):Al[Af];if(w!==null){if(w>0){y[Ae]+=w}if(Ap<0&&Ao>0){if(w<0){Aa[Ae]+=C.abs(w)}else{Av[Ae]+=w}}else{Av[Ae]+=C.abs(w-(w<0?Ao:Ap))}x.push(w)}}}else{w=Au?M(n[Ae],q,m):n[Ae];w=n[Ae]=U(w);if(w!==null){x.push(w)}}}this.max=Aw=C.max.apply(C,x);this.min=u=C.min.apply(C,x);this.stackMax=Ao=Aj?C.max.apply(C,y):Aw;this.stackMin=Ap=Aj?C.min.apply(C,x):u;if(Aq.get("chartRangeMin")!==B&&(Aq.get("chartRangeClip")||Aq.get("chartRangeMin")<u)){u=Aq.get("chartRangeMin")}if(Aq.get("chartRangeMax")!==B&&(Aq.get("chartRangeClip")||Aq.get("chartRangeMax")>Aw)){Aw=Aq.get("chartRangeMax")}this.zeroAxis=An=Aq.get("zeroAxis",true);if(u<=0&&Aw>=0&&An){Ar=0}else{if(An==false){Ar=u}else{if(u>0){Ar=u}else{Ar=Aw}}}this.xaxisOffset=Ar;s=Aj?(C.max.apply(C,Av)+C.max.apply(C,Aa)):Aw-u;this.canvasHeightEf=(An&&u<0)?this.canvasHeight-2:this.canvasHeight-1;if(u<Ar){At=(Aj&&Aw>=0)?Ao:Aw;p=(At-Ar)/s*this.canvasHeight;if(p!==C.ceil(p)){this.canvasHeightEf-=2;p=C.ceil(p)}}else{p=this.canvasHeight}this.yoffset=p;if(J.isArray(Aq.get("colorMap"))){this.colorMapByIndex=Aq.get("colorMap");this.colorMapByValue=null}else{this.colorMapByIndex=null;this.colorMapByValue=Aq.get("colorMap");if(this.colorMapByValue&&this.colorMapByValue.get===B){this.colorMapByValue=new W(this.colorMapByValue)}}this.range=s},getRegion:function(p,n,o){var m=C.floor(n/this.totalBarWidth);return(m<0||m>=this.values.length)?B:m},getCurrentRegionFields:function(){var p=this.currentRegion,q=D(this.values[p]),n=[],m,o;for(o=q.length;o--;){m=q[o];n.push({isNull:m===null,value:m,color:this.calcColor(o,m,p),offset:p})}return n},calcColor:function(t,p,n){var r=this.colorMapByIndex,q=this.colorMapByValue,m=this.options,o,s;if(this.stacked){o=m.get("stackedBarColor")}else{o=(p<0)?m.get("negBarColor"):m.get("barColor")}if(p===0&&m.get("zeroColor")!==B){o=m.get("zeroColor")}if(q&&(s=q.get(p))){o=s}else{if(r&&r.length>n){o=r[n]}}return J.isArray(o)?o[t%o.length]:o},renderRegion:function(Ag,u){var Aa=this.values[Ag],v=this.options,o=this.xaxisOffset,z=[],q=this.range,Ai=this.stacked,Af=this.target,Aj=Ag*this.totalBarWidth,t=this.canvasHeightEf,Ah=this.yoffset,m,p,Ab,Ad,w,Ac,n,s,Ae,r;Aa=J.isArray(Aa)?Aa:[Aa];n=Aa.length;s=Aa[0];Ad=k(null,Aa);r=k(o,Aa,true);if(Ad){if(v.get("nullColor")){Ab=u?v.get("nullColor"):this.calcHighlightColor(v.get("nullColor"),v);m=(Ah>0)?Ah-1:Ah;return Af.drawRect(Aj,m,this.barWidth-1,0,Ab,Ab)}else{return B}}w=Ah;for(Ac=0;Ac<n;Ac++){s=Aa[Ac];if(Ai&&s===o){if(!r||Ae){continue}Ae=true}if(q>0){p=C.floor(t*((C.abs(s-o)/q)))+1}else{p=1}if(s<o||(s===o&&Ah===0)){m=w;w+=p}else{m=Ah-p;Ah-=p}Ab=this.calcColor(Ac,s,Ag);if(u){Ab=this.calcHighlightColor(Ab,v)}z.push(Af.drawRect(Aj,m,this.barWidth-1,p-1,Ab,Ab))}if(z.length===1){return z[0]}return z}});J.fn.sparkline.tristate=N=L(J.fn.sparkline._base,b,{type:"tristate",init:function(o,s,r,p,n){var q=parseInt(r.get("barWidth"),10),m=parseInt(r.get("barSpacing"),10);N._super.init.call(this,o,s,r,p,n);this.regionShapes={};this.barWidth=q;this.barSpacing=m;this.totalBarWidth=q+m;this.values=J.map(s,Number);this.width=p=(s.length*q)+((s.length-1)*m);if(J.isArray(r.get("colorMap"))){this.colorMapByIndex=r.get("colorMap");this.colorMapByValue=null}else{this.colorMapByIndex=null;this.colorMapByValue=r.get("colorMap");if(this.colorMapByValue&&this.colorMapByValue.get===B){this.colorMapByValue=new W(this.colorMapByValue)}}this.initTarget()},getRegion:function(o,m,n){return C.floor(m/this.totalBarWidth)},getCurrentRegionFields:function(){var m=this.currentRegion;return{isNull:this.values[m]===B,value:this.values[m],color:this.calcColor(this.values[m],m),offset:m}},calcColor:function(p,n){var s=this.values,m=this.options,r=this.colorMapByIndex,q=this.colorMapByValue,o,t;if(q&&(t=q.get(p))){o=t}else{if(r&&r.length>n){o=r[n]}else{if(s[n]<0){o=m.get("negBarColor")}else{if(s[n]>0){o=m.get("posBarColor")}else{o=m.get("zeroBarColor")}}}}return o},renderRegion:function(n,o){var t=this.values,m=this.options,w=this.target,u,s,r,p,q,v;u=w.pixelHeight;r=C.round(u/2);p=n*this.totalBarWidth;if(t[n]<0){q=r;s=r-1}else{if(t[n]>0){q=0;s=r-1}else{q=r-1;s=2}}v=this.calcColor(t[n],n);if(v===null){return}if(o){v=this.calcHighlightColor(v,m)}return w.drawRect(p,q,this.barWidth-1,s-1,v,v)}});J.fn.sparkline.discrete=X=L(J.fn.sparkline._base,b,{type:"discrete",init:function(n,q,p,o,m){X._super.init.call(this,n,q,p,o,m);this.regionShapes={};this.values=q=J.map(q,Number);this.min=C.min.apply(C,q);this.max=C.max.apply(C,q);this.range=this.max-this.min;this.width=o=p.get("width")==="auto"?q.length*2:this.width;this.interval=C.floor(o/q.length);this.itemWidth=o/q.length;if(p.get("chartRangeMin")!==B&&(p.get("chartRangeClip")||p.get("chartRangeMin")<this.min)){this.min=p.get("chartRangeMin")}if(p.get("chartRangeMax")!==B&&(p.get("chartRangeClip")||p.get("chartRangeMax")>this.max)){this.max=p.get("chartRangeMax")}this.initTarget();if(this.target){this.lineHeight=p.get("lineHeight")==="auto"?C.round(this.canvasHeight*0.3):p.get("lineHeight")}},getRegion:function(o,m,n){return C.floor(m/this.itemWidth)},getCurrentRegionFields:function(){var m=this.currentRegion;return{isNull:this.values[m]===B,value:this.values[m],offset:m}},renderRegion:function(n,p){var v=this.values,m=this.options,o=this.min,Ab=this.max,t=this.range,Ac=this.interval,Aa=this.target,w=this.canvasHeight,y=this.lineHeight,u=w-y,r,q,z,s;q=M(v[n],o,Ab);s=n*Ac;r=C.round(u-u*((q-o)/t));z=(m.get("thresholdColor")&&q<m.get("thresholdValue"))?m.get("thresholdColor"):m.get("lineColor");if(p){z=this.calcHighlightColor(z,m)}return Aa.drawLine(s,r,s,r+y,z)}});J.fn.sparkline.bullet=l=L(J.fn.sparkline._base,{type:"bullet",init:function(p,r,m,n,q){var o,t,s;l._super.init.call(this,p,r,m,n,q);this.values=r=R(r);s=r.slice();s[0]=s[0]===null?s[2]:s[0];s[1]=r[1]===null?s[2]:s[1];o=C.min.apply(C,r);t=C.max.apply(C,r);if(m.get("base")===B){o=o<0?o:0}else{o=m.get("base")}this.min=o;this.max=t;this.range=t-o;this.shapes={};this.valueShapes={};this.regiondata={};this.width=n=m.get("width")==="auto"?"4.0em":n;this.target=this.$el.simpledraw(n,q,m.get("composite"));if(!r.length){this.disabled=true}this.initTarget()},getRegion:function(o,m,n){var p=this.target.getShapeAt(o,m,n);return(p!==B&&this.shapes[p]!==B)?this.shapes[p]:B},getCurrentRegionFields:function(){var m=this.currentRegion;return{fieldkey:m.substr(0,1),value:this.values[m.substr(1)],region:m}},changeHighlight:function(m){var p=this.currentRegion,n=this.valueShapes[p],o;delete this.shapes[n];switch(p.substr(0,1)){case"r":o=this.renderRange(p.substr(1),m);break;case"p":o=this.renderPerformance(m);break;case"t":o=this.renderTarget(m);break}this.valueShapes[p]=o.id;this.shapes[o.id]=p;this.target.replaceWithShape(n,o)},renderRange:function(n,m){var o=this.values[n],p=C.round(this.canvasWidth*((o-this.min)/this.range)),q=this.options.get("rangeColors")[n-2];if(m){q=this.calcHighlightColor(q,this.options)}return this.target.drawRect(0,0,p-1,this.canvasHeight-1,q,q)},renderPerformance:function(n){var m=this.values[1],p=C.round(this.canvasWidth*((m-this.min)/this.range)),o=this.options.get("performanceColor");if(n){o=this.calcHighlightColor(o,this.options)}return this.target.drawRect(0,C.round(this.canvasHeight*0.3),p-1,C.round(this.canvasHeight*0.4)-1,o,o)},renderTarget:function(n){var q=this.values[0],m=C.round(this.canvasWidth*((q-this.min)/this.range)-(this.options.get("targetWidth")/2)),p=C.round(this.canvasHeight*0.1),o=this.canvasHeight-(p*2),r=this.options.get("targetColor");if(n){r=this.calcHighlightColor(r,this.options)}return this.target.drawRect(m,p,this.options.get("targetWidth")-1,o-1,r,r)},render:function(){var p=this.values.length,n=this.target,m,o;if(!l._super.render.call(this)){return}for(m=2;m<p;m++){o=this.renderRange(m).append();this.shapes[o.id]="r"+m;this.valueShapes["r"+m]=o.id}if(this.values[1]!==null){o=this.renderPerformance().append();this.shapes[o.id]="p1";this.valueShapes.p1=o.id}if(this.values[0]!==null){o=this.renderTarget().append();this.shapes[o.id]="t0";this.valueShapes.t0=o.id}n.render()}});J.fn.sparkline.pie=Z=L(J.fn.sparkline._base,{type:"pie",init:function(o,r,q,p,n){var m=0,s;Z._super.init.call(this,o,r,q,p,n);this.shapes={};this.valueShapes={};this.values=r=J.map(r,Number);if(q.get("width")==="auto"){this.width=this.height}if(r.length>0){for(s=r.length;s--;){m+=r[s]}}this.total=m;this.initTarget();this.radius=C.floor(C.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(o,m,n){var p=this.target.getShapeAt(o,m,n);return(p!==B&&this.shapes[p]!==B)?this.shapes[p]:B},getCurrentRegionFields:function(){var m=this.currentRegion;return{isNull:this.values[m]===B,value:this.values[m],percent:this.values[m]/this.total*100,color:this.options.get("sliceColors")[m%this.options.get("sliceColors").length],offset:m}},changeHighlight:function(m){var p=this.currentRegion,n=this.renderSlice(p,m),o=this.valueShapes[p];delete this.shapes[o];this.target.replaceWithShape(o,n);this.valueShapes[p]=n.id;this.shapes[n.id]=p},renderSlice:function(n,p){var y=this.target,m=this.options,q=this.radius,Aa=m.get("borderWidth"),Ab=m.get("offset"),x=2*C.PI,t=this.values,r=this.total,o=Ab?(2*C.PI)*(Ab/360):0,v,s,w,u,z;u=t.length;for(w=0;w<u;w++){v=o;s=o;if(r>0){s=o+(x*(t[w]/r))}if(n===w){z=m.get("sliceColors")[w%m.get("sliceColors").length];if(p){z=this.calcHighlightColor(z,m)}return y.drawPieSlice(q,q,q-Aa,v,s,B,z)}o=s}},render:function(){var p=this.target,s=this.values,r=this.options,m=this.radius,n=r.get("borderWidth"),q,o;if(!Z._super.render.call(this)){return}if(n){p.drawCircle(m,m,C.floor(m-(n/2)),r.get("borderColor"),B,n).append()}for(o=s.length;o--;){if(s[o]){q=this.renderSlice(o).append();this.valueShapes[o]=q.id;this.shapes[q.id]=o}}p.render()}});J.fn.sparkline.box=G=L(J.fn.sparkline._base,{type:"box",init:function(n,q,p,o,m){G._super.init.call(this,n,q,p,o,m);this.values=J.map(q,Number);this.width=p.get("width")==="auto"?"4.0em":o;this.initTarget();if(!this.values.length){this.disabled=1}},getRegion:function(){return 1},getCurrentRegionFields:function(){var m=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];if(this.loutlier!==B){m.push({field:"lo",value:this.loutlier})}if(this.routlier!==B){m.push({field:"ro",value:this.routlier})}if(this.lwhisker!==B){m.push({field:"lw",value:this.lwhisker})}if(this.rwhisker!==B){m.push({field:"rw",value:this.rwhisker})}return m},render:function(){var Ac=this.target,Af=this.values,Ad=Af.length,w=this.options,r=this.canvasWidth,t=this.canvasHeight,Ae=w.get("chartRangeMin")===B?C.min.apply(C,Af):w.get("chartRangeMin"),p=w.get("chartRangeMax")===B?C.max.apply(C,Af):w.get("chartRangeMax"),Ab=0,z,m,q,Aa,o,x,u,s,v,y,n;if(!G._super.render.call(this)){return}if(w.get("raw")){if(w.get("showOutliers")&&Af.length>5){m=Af[0];z=Af[1];Aa=Af[2];o=Af[3];x=Af[4];u=Af[5];s=Af[6]}else{z=Af[0];Aa=Af[1];o=Af[2];x=Af[3];u=Af[4]}}else{Af.sort(function(Ag,Ah){return Ag-Ah});Aa=h(Af,1);o=h(Af,2);x=h(Af,3);q=x-Aa;if(w.get("showOutliers")){z=u=B;for(v=0;v<Ad;v++){if(z===B&&Af[v]>Aa-(q*w.get("outlierIQR"))){z=Af[v]}if(Af[v]<x+(q*w.get("outlierIQR"))){u=Af[v]}}m=Af[0];s=Af[Ad-1]}else{z=Af[0];u=Af[Ad-1]}}this.quartiles=[Aa,o,x];this.lwhisker=z;this.rwhisker=u;this.loutlier=m;this.routlier=s;n=r/(p-Ae+1);if(w.get("showOutliers")){Ab=C.ceil(w.get("spotRadius"));r-=2*C.ceil(w.get("spotRadius"));n=r/(p-Ae+1);if(m<z){Ac.drawCircle((m-Ae)*n+Ab,t/2,w.get("spotRadius"),w.get("outlierLineColor"),w.get("outlierFillColor")).append()}if(s>u){Ac.drawCircle((s-Ae)*n+Ab,t/2,w.get("spotRadius"),w.get("outlierLineColor"),w.get("outlierFillColor")).append()}}Ac.drawRect(C.round((Aa-Ae)*n+Ab),C.round(t*0.1),C.round((x-Aa)*n),C.round(t*0.8),w.get("boxLineColor"),w.get("boxFillColor")).append();Ac.drawLine(C.round((z-Ae)*n+Ab),C.round(t/2),C.round((Aa-Ae)*n+Ab),C.round(t/2),w.get("lineColor")).append();Ac.drawLine(C.round((z-Ae)*n+Ab),C.round(t/4),C.round((z-Ae)*n+Ab),C.round(t-t/4),w.get("whiskerColor")).append();Ac.drawLine(C.round((u-Ae)*n+Ab),C.round(t/2),C.round((x-Ae)*n+Ab),C.round(t/2),w.get("lineColor")).append();Ac.drawLine(C.round((u-Ae)*n+Ab),C.round(t/4),C.round((u-Ae)*n+Ab),C.round(t-t/4),w.get("whiskerColor")).append();Ac.drawLine(C.round((o-Ae)*n+Ab),C.round(t*0.1),C.round((o-Ae)*n+Ab),C.round(t*0.9),w.get("medianColor")).append();if(w.get("target")){y=C.ceil(w.get("spotRadius"));Ac.drawLine(C.round((w.get("target")-Ae)*n+Ab),C.round((t/2)-y),C.round((w.get("target")-Ae)*n+Ab),C.round((t/2)+y),w.get("targetColor")).append();Ac.drawLine(C.round((w.get("target")-Ae)*n+Ab-y),C.round(t/2),C.round((w.get("target")-Ae)*n+Ab+y),C.round(t/2),w.get("targetColor")).append()}Ac.render()}});i=L({init:function(n,p,m,o){this.target=n;this.id=p;this.type=m;this.args=o},append:function(){this.target.appendShape(this);return this}});a=L({_pxregex:/(\d+)(px)?\s*$/i,init:function(n,m,o){if(!n){return}this.width=n;this.height=m;this.target=o;this.lastShapeId=null;if(o[0]){o=o[0]}J.data(o,"_jqs_vcanvas",this)},drawLine:function(m,n,q,r,p,o){return this.drawShape([[m,n],[q,r]],p,o)},drawShape:function(n,o,m,p){return this._genShape("Shape",[n,o,m,p])},drawCircle:function(n,o,m,q,p,r){return this._genShape("Circle",[n,o,m,q,p,r])},drawPieSlice:function(n,o,m,q,s,r,p){return this._genShape("PieSlice",[n,o,m,q,s,r,p])},drawRect:function(m,n,o,p,r,q){return this._genShape("Rect",[m,n,o,p,r,q])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(m,n){J(n).html(m)},_calculatePixelDims:function(n,m,p){var o;o=this._pxregex.exec(m);if(o){this.pixelHeight=o[1]}else{this.pixelHeight=J(p).height()}o=this._pxregex.exec(n);if(o){this.pixelWidth=o[1]}else{this.pixelWidth=J(p).width()}},_genShape:function(n,m){var o=V++;m.unshift(o);return new i(this,o,n,m)},appendShape:function(m){alert("appendShape not implemented")},replaceWithShape:function(m,n){alert("replaceWithShape not implemented")},insertAfterShape:function(m,n){alert("insertAfterShape not implemented")},removeShapeId:function(m){alert("removeShapeId not implemented")},getShapeAt:function(o,m,n){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}});H=L(a,{init:function(n,m,o,p){H._super.init.call(this,n,m,o);this.canvas=A.createElement("canvas");if(o[0]){o=o[0]}J.data(o,"_jqs_vcanvas",this);J(this.canvas).css({display:"inline-block",width:n,height:m,verticalAlign:"top"});this._insert(this.canvas,o);this._calculatePixelDims(n,m,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;this.interact=p;this.shapes={};this.shapeseq=[];this.currentTargetShapeId=B;J(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(o,n,p){var m=this.canvas.getContext("2d");if(o!==B){m.strokeStyle=o}m.lineWidth=p===B?1:p;if(n!==B){m.fillStyle=n}return m},reset:function(){var m=this._getContext();m.clearRect(0,0,this.pixelWidth,this.pixelHeight);this.shapes={};this.shapeseq=[];this.currentTargetShapeId=B},_drawShape:function(o,s,q,n,p){var r=this._getContext(q,n,p),m,t;r.beginPath();r.moveTo(s[0][0]+0.5,s[0][1]+0.5);for(m=1,t=s.length;m<t;m++){r.lineTo(s[m][0]+0.5,s[m][1]+0.5)}if(q!==B){r.stroke()}if(n!==B){r.fill()}if(this.targetX!==B&&this.targetY!==B&&r.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=o}},_drawCircle:function(q,p,n,m,s,o,r){var t=this._getContext(s,o,r);t.beginPath();t.arc(p,n,m,0,2*C.PI,false);if(this.targetX!==B&&this.targetY!==B&&t.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=q}if(s!==B){t.stroke()}if(o!==B){t.fill()}},_drawPieSlice:function(q,p,t,m,u,n,s,r){var o=this._getContext(s,r);o.beginPath();o.moveTo(p,t);o.arc(p,t,m,u,n,false);o.lineTo(p,t);o.closePath();if(s!==B){o.stroke()}if(r){o.fill()}if(this.targetX!==B&&this.targetY!==B&&o.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=q}},_drawRect:function(p,m,n,o,r,s,q){return this._drawShape(p,[[m,n],[m+o,n],[m+o,n+r],[m,n+r],[m,n]],s,q)},appendShape:function(m){this.shapes[m.id]=m;this.shapeseq.push(m.id);this.lastShapeId=m.id;return m.id},replaceWithShape:function(m,n){var p=this.shapeseq,o;this.shapes[n.id]=n;for(o=p.length;o--;){if(p[o]==m){p[o]=n.id}}delete this.shapes[m]},replaceWithShapes:function(s,p){var q=this.shapeseq,o={},m,r,n;for(r=s.length;r--;){o[s[r]]=true}for(r=q.length;r--;){m=q[r];if(o[m]){q.splice(r,1);delete this.shapes[m];n=r}}for(r=p.length;r--;){q.splice(n,0,p[r].id);this.shapes[p[r].id]=p[r]}},insertAfterShape:function(m,n){var p=this.shapeseq,o;for(o=p.length;o--;){if(p[o]===m){p.splice(o+1,0,n.id);this.shapes[n.id]=n;return}}},removeShapeId:function(m){var n=this.shapeseq,o;for(o=n.length;o--;){if(n[o]===m){n.splice(o,1);break}}delete this.shapes[m]},getShapeAt:function(o,m,n){this.targetX=m;this.targetY=n;this.render();return this.currentTargetShapeId},render:function(){var p=this.shapeseq,o=this.shapes,m=p.length,s=this._getContext(),n,q,r;s.clearRect(0,0,this.pixelWidth,this.pixelHeight);for(r=0;r<m;r++){n=p[r];q=o[n];this["_draw"+q.type].apply(this,q.args)}if(!this.interact){this.shapes={};this.shapeseq=[]}}});P=L(a,{init:function(n,m,o){var p;P._super.init.call(this,n,m,o);if(o[0]){o=o[0]}J.data(o,"_jqs_vcanvas",this);this.canvas=A.createElement("span");J(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:n,height:m,margin:"0px",padding:"0px",verticalAlign:"top"});this._insert(this.canvas,o);this._calculatePixelDims(n,m,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;p='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>';this.canvas.insertAdjacentHTML("beforeEnd",p);this.group=J(this.canvas).children()[0];this.rendered=false;this.prerender=""},_drawShape:function(p,x,t,y,q){var o=[],s,m,n,r,w,u,v;for(v=0,u=x.length;v<u;v++){o[v]=""+(x[v][0])+","+(x[v][1])}s=o.splice(0,1);q=q===B?1:q;m=t===B?' stroked="false" ':' strokeWeight="'+q+'px" strokeColor="'+t+'" ';n=y===B?' filled="false"':' fillColor="'+y+'" filled="true" ';r=o[0]===o[o.length-1]?"x ":"";w='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+p+'" '+m+n+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+s+" l "+o.join(", ")+" "+r+'e"> </v:shape>';return w},_drawCircle:function(r,q,n,m,t,o,s){var v,p,u;q-=m;n-=m;v=t===B?' stroked="false" ':' strokeWeight="'+s+'px" strokeColor="'+t+'" ';p=o===B?' filled="false"':' fillColor="'+o+'" filled="true" ';u='<v:oval  id="jqsshape'+r+'" '+v+p+' style="position:absolute;top:'+n+"px; left:"+q+"px; width:"+(m*2)+"px; height:"+(m*2)+'px"></v:oval>';return u},_drawPieSlice:function(r,q,Aa,m,Ad,n,w,s){var v,p,Ab,o,u,Ac,t,z;if(Ad===n){return""}if((n-Ad)===(2*C.PI)){Ad=0;n=(2*C.PI)}p=q+C.round(C.cos(Ad)*m);Ab=Aa+C.round(C.sin(Ad)*m);o=q+C.round(C.cos(n)*m);u=Aa+C.round(C.sin(n)*m);if(p===o&&Ab===u){if((n-Ad)<C.PI){return""}p=o=q+m;Ab=u=Aa}if(p===o&&Ab===u&&(n-Ad)<C.PI){return""}v=[q-m,Aa-m,q+m,Aa+m,p,Ab,o,u];Ac=w===B?' stroked="false" ':' strokeWeight="1px" strokeColor="'+w+'" ';t=s===B?' filled="false"':' fillColor="'+s+'" filled="true" ';z='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+r+'" '+Ac+t+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+q+","+Aa+" wa "+v.join(", ")+' x e"> </v:shape>';return z},_drawRect:function(p,m,n,o,r,s,q){return this._drawShape(p,[[m,n],[m,n+r],[m+o,n+r],[m+o,n],[m,n]],s,q)},reset:function(){this.group.innerHTML=""},appendShape:function(n){var m=this["_draw"+n.type].apply(this,n.args);if(this.rendered){this.group.insertAdjacentHTML("beforeEnd",m)}else{this.prerender+=m}this.lastShapeId=n.id;return n.id},replaceWithShape:function(o,p){var n=J("#jqsshape"+o),m=this["_draw"+p.type].apply(this,p.args);n[0].outerHTML=m},replaceWithShapes:function(r,o){var n=J("#jqsshape"+r[0]),m="",q=o.length,p;for(p=0;p<q;p++){m+=this["_draw"+o[p].type].apply(this,o[p].args)}n[0].outerHTML=m;for(p=1;p<r.length;p++){J("#jqsshape"+r[p]).remove()}},insertAfterShape:function(o,p){var n=J("#jqsshape"+o),m=this["_draw"+p.type].apply(this,p.args);n[0].insertAdjacentHTML("afterEnd",m)},removeShapeId:function(n){var m=J("#jqsshape"+n);this.group.removeChild(m[0])},getShapeAt:function(o,m,n){var p=o.id.substr(8);return p},render:function(){if(!this.rendered){this.group.innerHTML=this.prerender;this.rendered=true}}})}))}(document,Math));